# SoxDrawer

A secure, token-based object store with drag & drop interface.

## Features

- **Secure Authentication**: Token-based authentication for both NATS and HTTP servers
- **Drag & Drop Interface**: Modern web interface for easy file uploads
- **Multiple Content Types**: Support for files, text, and URLs
- **NATS JetStream Backend**: Reliable message streaming and object storage
- **Session Management**: Secure session cookies with configurable duration
- **Firefox Extension**: Browser extension for easy content saving from any webpage

## Firefox Extension

SoxDrawer includes a Firefox extension that allows you to save content directly from any webpage to your SoxDrawer storage.

### Features

- **Floating Button**: Quick access button on every webpage
- **Drag & Drop**: Drop files, text, or links from any webpage
- **Popup Interface**: Clean interface to view and manage stored items
- **File Upload**: Upload files directly from the extension
- **Item Management**: Download and delete stored items

### Installation

1. Navigate to the `firefox-extension` directory
2. Run the build script: `./build.sh`
3. Open Firefox and go to `about:addons`
4. Click the gear icon and select "Install Add-on From File..."
5. Select the generated `soxdrawer-extension.zip` file

### Usage

- Click the SoxDrawer icon in the Firefox toolbar to open the popup
- Use the floating button (üìÅ) on any webpage for quick access
- Drag and drop content from web pages to automatically save to SoxDrawer
- View, download, and delete stored items through the popup interface

For detailed documentation, see [firefox-extension/README.md](firefox-extension/README.md).

## Authentication

SoxDrawer implements a comprehensive authentication system to secure both the NATS server and HTTP interface.

### HTTP Authentication

The HTTP server uses token-based authentication with the following features:

- **Secure Session Tokens**: HMAC-signed session tokens with timestamp validation
- **Configurable Duration**: Session duration can be set in the configuration (default: 12 hours)
- **HttpOnly Cookies**: Secure cookie implementation prevents XSS attacks
- **Automatic Redirects**: Unauthenticated users are redirected to the login page
- **Logout Support**: Users can log out to invalidate their session

#### Authentication Flow

1. **Initial Access**: When accessing the application, unauthenticated users are redirected to `/login`
2. **Login Page**: A clean, responsive login form is presented
3. **Token Validation**: Users enter the authentication token from the configuration
4. **Session Creation**: Upon successful authentication, a secure session cookie is set
5. **Access Granted**: Users can now access all protected resources
6. **Session Management**: Sessions automatically expire after the configured duration

#### Configuration

The authentication token is automatically generated on first run and stored in the configuration file:

```toml
[http]
address = ":8080"

[http.auth]
token = "your-generated-token-here"
session_duration_hours = 12
```

#### Security Features

- **HMAC-Signed Sessions**: Session tokens are cryptographically signed to prevent tampering
- **Timestamp Validation**: Sessions include timestamps to enforce expiration
- **Secure Cookies**: HttpOnly, SameSite, and secure flags for cookie security
- **Token Rotation**: Authentication tokens can be regenerated by clearing the config file

### NATS Authentication

The NATS server is secured with token-based authentication:

- **Automatic Token Generation**: Tokens are generated on first run
- **Secure Storage**: Tokens are stored in the configuration file with restricted permissions
- **Client Authentication**: All NATS clients must provide the correct token

## Architecture

**Blob Storage**
- Golang application
- Embedded NATS Server (~20mb)
- NATS Client in order to communicate to the object store

**Browser interface**
- Embedded HTTP Server
- Frontend will be HTML/CSS/JS or React.

### UX

The main UI will be a drag and drop area where users will be able to drag links/files/pictures/text to.

#### References

- [Object Store NATS](https://docs.nats.io/nats-concepts/jetstream/obj_store)

## Security Implementation

### NATS Token Authentication

SoxDrawer now implements token-based authentication for the NATS server to secure communications between the HTTP server and NATS.

#### Configuration

The application uses a TOML configuration file (`soxdrawer.config.toml`) that contains:

```toml
# SoxDrawer Configuration
# This file contains sensitive authentication tokens - keep it secure!

[nats]
  host = "127.0.0.1"
  port = 4222
  store_dir = "./jetstream"
  token = "your-secure-token-here"

[http]
  address = ":8080"
```

#### Token Management

Use the `nats-client` utility to manage authentication tokens:

```bash
# Generate a new token and save configuration
./bin/nats-client -new-token

# Show current token
./bin/nats-client -show-token

# Display current configuration
./bin/nats-client -show-config

# Test NATS connection (validates config)
./bin/nats-client -test
```

#### Security Features

- **256-bit secure random tokens** generated using cryptographically secure random number generation
- **Configuration file permissions** set to 0600 (owner read/write only)
- **Automatic token generation** if none exists
- **Connection authentication** required for all NATS clients
- **Token isolation** between HTTP server and NATS server

#### Configuration File Security

The configuration file contains sensitive authentication tokens and should be:
- Kept secure with restricted file permissions (0600)
- Not committed to version control (already in .gitignore)
- Backed up securely if needed
- Regenerated periodically for security
